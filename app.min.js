var oM=angular.module("O2",["ngRoute","ngDialog","ngAnimate","ngSanitize","ui.select","ui.grid","ui.grid.selection","ui.grid.autoResize","ui.grid.resizeColumns","ngMap","chart.js"]);
oM.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$locationProvider.html5Mode({enabled:true,requireBase:false});$routeProvider.when("/login",{templateUrl:"views/login.html",controller:"oMCtrl",controllerAs:"C0"});$routeProvider.when("/start",{templateUrl:"company02/views/start.html",controller:"oStartCtrl",controllerAs:"C1"});$routeProvider.when("/maps",{templateUrl:"company02/views/maps.html",controller:"oMapsCtrl",controllerAs:"C2"});$routeProvider.when("/charts",{templateUrl:"company02/views/charts.html",
controller:"oChartsCtrl",controllerAs:"C3"});$routeProvider.when("/details",{templateUrl:"views/details.html",controller:"oDetailsCtrl",controllerAs:"C4"});$routeProvider.otherwise({templateUrl:"views/login.html",controller:"oMCtrl as C0",controllerAs:"C0"})}]);
oM.run(["$window","$rootScope",function($window,$rootScope){$rootScope.online=navigator.onLine;$window.addEventListener("offline",function(){$rootScope.$apply(function(){$rootScope.online=false})},false);$window.addEventListener("online",function(){$rootScope.$apply(function(){$rootScope.online=true})},false)}]);oM.directive("menu",function(){return{restrict:"E",template:'<div ng-class=\'{ show: visible, left: alignment === "left", right: alignment === "right" }\' ng-transclude></div>',transclude:true,scope:{visible:"=",alignment:"@"}}});oM.directive("menuItem",function(){return{restrict:"E",template:"<div ng-click='navigate()' ng-transclude></div>",transclude:true,scope:{hash:"@"},link:function($scope){$scope.navigate=function(){window.location.hash=$scope.hash}}}});
oM.directive("clickOutside",function(){return function(scope,elem){var x=document.getElementsByTagName("BODY")[0];x.addEventListener("click",function(){dropdown=false;scope.$apply()});elem.addEventListener("click",function(e){e.stopPropagation()})}});oM.factory("w",function(){var engLang={viewLogin:{title:"O2 Solutions",phU:{f:"Username",v:"",c:"n",inv:"Invalid account name"},phP:{f:"Password",v:"",c:"n",inv:"Invalid password"},signIn:"Sign in",passForget:"Forgot Password",loadingImg0:{h:true,v:"img/l0.gif"}},ID:"",buttons:{signIn:{v:"Sign in",p:false,img:"img/l0.gif"}},gW:{connectionIssues:"connection issues, try again",enterUP:"Enter account and password",enterU:"Enter account",enterP:"Enter password",logStr:"Please wait while logging",invl:"Entered account and password are invalid",
tblNoSelection:"Please select some data fields"}};var r=engLang;r.windowTimeOpen=2200;return r});oM.factory("changeview",function(){return function(l,v){l.url(v)}});
oM.factory("csvToArray",function(){return function(url){var r=[];function processData(allText){var allTextLines=allText.split(/\r\n|\n/);var headers=allTextLines[0].split(",");for(var i=1;i<allTextLines.length;i++){var data=allTextLines[i].split(",");if(data.length==headers.length){var tarr=[];for(var j=0;j<headers.length;j++)tarr.push(headers[j]+":"+data[j]);r.push(tarr)}}}function setHeader(xhr){xhr.setRequestHeader("x-ms-version","2014-02-14");xhr.setRequestHeader("MaxDataServiceVersion","3.0");
xhr.setRequestHeader("Accept","application/json;odata=nometadata")}$.ajax({type:"GET",url:url,dataType:"text",async:false,success:function(data){processData(data)}});return r}});
oM.factory("csvToJson",function(){return function(url){var rD=[];function processData(data){rD.length=0;var rows=data.split(/\r\n|\n/);var columns=rows[0].split(",");for(var i=1;i<rows.length;i++){var column=rows[i].split(",");if(column.length==columns.length){var object={};for(var j=0;j<columns.length;j++)object[columns[j]]=column[j];rD.push(object)}}}$.ajax({type:"GET",url:url,dataType:"text",async:false,success:function(data){processData(data)}});return rD}});
oM.factory("getJsonFile",function(){return function(url){var rD;function processData(data){rD=JSON.parse(data)}$.ajax({type:"GET",url:url,dataType:"text",async:false,success:function(data){processData(data)}});return rD}});
oM.factory("caching",function(){return{setCache:function(s,k,v,o){c:{var r={};if(typeof window[s]!=="undefined"){r.s="Y";if(o){window[s].removeItem(k);window[s].setItem(k,v)}else if(typeof window[s][k]=="undefined")window[s].setItem(k,v);r.f="N";return r;break c}else{r.s="N";return r;break c}}},getCache:function(s,k){c:if(typeof window[s][k]!=="undefined"){return JSON.parse(window[s][k]);break c}else{return false;break c}}}});
oM.factory("updateCache",function(){var r=false;return function(caching,cacheType,cacheAction,cacheName,jsonStringifyYesNot,cacheNewData,cacheNewDataType,cacheNewDataIndexKey){if(localStorage.getItem(cacheName)!==null)outer:switch(cacheAction.toLowerCase().trim()){case "delete":window[cacheType].removeItem(cacheName);break outer;case "replace":if(jsonStringifyYesNot)caching.setCache(cacheType,cacheName,JSON.stringify(cacheNewData),true);else caching.setCache(cacheType,cacheName,cacheNewData,true);
break outer;case "update":if(cacheNewDataType.toLowerCase().trim()==="array"){var t=caching.getCache(cacheType,cacheName);t[cacheNewDataIndexKey]=cacheNewData[0];if(jsonStringifyYesNot)caching.setCache(cacheType,cacheName,JSON.stringify(t),true);else caching.setCache(cacheType,cacheName,t,true)}else;break outer;default:break outer}else if(jsonStringifyYesNot)caching.setCache(cacheType,cacheName,JSON.stringify(cacheNewData),false);else caching.setCache(cacheType,cacheName,cacheNewData,false);return r}});
oM.factory("toUSD",function(){return function(n){var number=n.toString(),dollars=number.split(".")[0],cents=(number.split(".")[1]||"")+"00";dollars=dollars.split("").reverse().join("").replace(/(\d{3}(?!$))/g,"$1,").split("").reverse().join("");if(cents.slice(0,2)=="00")return"$ "+dollars;else return"$ "+dollars+"."+cents.slice(0,2)}});
oM.factory("getOpenClosedIssues",function(){return function(d){var r={};r.open=0;r.closed=0;var c=d.length;for(var i=0;i<c;i++)if(d[i]["open/closed status"]==="Open")r.open+=1;else r.closed+=1;return r}});
oM.factory("dataGrouping",function(){return function(d,f){function weekNum(date){return f("date")(date,"ww")}function dayStr(n){switch(n){case 0:return"Sunday";break;case 1:return"Monday";break;case 2:return"Tuesday";break;case 3:return"Wednesday";break;case 4:return"Thursday";break;case 5:return"Friday";break;case 6:return"Saturday";break;default:return""}}function monthStr(n){switch(n){case 0:return"January";break;case 1:return"February";break;case 2:return"March";break;case 3:return"April";break;
case 4:return"May";break;case 5:return"June";break;case 6:return"July";break;case 7:return"August";break;case 8:return"September";break;case 9:return"October";break;case 10:return"November";break;case 11:return"December";break;default:return""}}var t=d;var c=t.length;for(var i=0;i<c;i++){var st=undefined,ct,dayStrst,dayStrct,weekNumst,weekNumct,monthStrst,monthStrct,jDst,jDct,arrst,arrct;arrst=t[i]["submission timestamp"].split("|");arrct=t[i]["closed timestamp"].split("|");if(arrct.length>1){var dd=
new Date(new Date(arrct[0]));t[i].ct=dd;t[i].ctMonth=monthStr(dd.getMonth());t[i].ctMonthNum=dd.getMonth();t[i].ctDay=dayStr(dd.getDay());t[i].ctDayNum=dd.getDay();t[i].ctWeek=weekNum(dd)}else{t[i].ct="";t[i].ctMonth="";t[i].ctDay="";t[i].ctWeek=""}if(arrst.length>1){var dd$0=new Date(new Date(arrst[0]));t[i].st=dd$0;t[i].stMonth=monthStr(dd$0.getMonth());t[i].stMonthNum=dd$0.getMonth();t[i].stDay=dayStr(dd$0.getDay());t[i].stDayNum=dd$0.getDay();t[i].stWeek=weekNum(dd$0)}else{t[i].st="";t[i].stMonth=
"";t[i].stDay="";t[i].stWeek=""}}var r={};r.arrMonthCT=[];r.arrMonthCTData={};r.arrMonthCTData.arr0=[];r.arrMonthCTData.arr1=[];r.arrMonthCTData.arrLabels=[];r.arrMonthST=[];r.arrMonthSTData={};r.arrMonthSTData.arr0=[];r.arrMonthSTData.arr1=[];r.arrMonthSTData.arrLabels=[];var tt=t.sort(function(a,b){return a.ct-b.ct});var counter=0;var total=0;for(var i$1=0;i$1<c;i$1++){var obj={};obj.total=0;obj.counter=0;obj.month="";if(tt[i$1].paid!=="")if(i$1!==c-1)if(tt[i$1].ctMonth===tt[i$1+1].ctMonth){counter+=
1;total+=Number(tt[i$1].paid)}else{counter+=1;total+=Number(tt[i$1].paid);obj.total=total;obj.counter=counter;obj.month=tt[i$1].ctMonth;r.arrMonthCT.push(obj);r.arrMonthCTData.arr0.push(counter);r.arrMonthCTData.arr1.push(total);r.arrMonthCTData.arrLabels.push(tt[i$1].ctMonth);counter=0;total=0}else{counter+=1;total+=Number(tt[i$1].paid);obj.total=total;obj.counter=counter;obj.month=tt[i$1].ctMonth;r.arrMonthCT.push(obj);r.arrMonthCTData.arr0.push(counter);r.arrMonthCTData.arr1.push(total);r.arrMonthCTData.arrLabels.push(tt[i$1].ctMonth)}else;
}tt=t.sort(function(a,b){return a.st-b.st});counter=0;var closed=0;for(var i$2=0;i$2<c;i$2++){var obj$3={};obj$3.closed=0;obj$3.counter=0;obj$3.month="";if(i$2!==c-1)if(tt[i$2].stMonth===tt[i$2+1].stMonth){counter+=1;if(tt[i$2]["open/closed status"]==="Closed")closed+=1}else{counter+=1;if(tt[i$2]["open/closed status"]==="Closed")closed+=1;obj$3.closed=closed;obj$3.counter=counter;obj$3.month=tt[i$2].stMonth;r.arrMonthST.push(obj$3);r.arrMonthSTData.arr0.push(counter);r.arrMonthSTData.arr1.push(closed);
r.arrMonthSTData.arrLabels.push(tt[i$2].stMonth);counter=0;closed=0}else{counter+=1;if(tt[i$2]["open/closed status"]==="Closed")closed+=1;obj$3.closed=closed;obj$3.counter=counter;obj$3.month=tt[i$2].stMonth;r.arrMonthST.push(obj$3);r.arrMonthSTData.arr0.push(counter);r.arrMonthSTData.arr1.push(closed);r.arrMonthSTData.arrLabels.push(tt[i$2].stMonth)}}return r}});var oMCtrl=oM.controller("oMCtrl",["$scope","$http","$location","$rootScope","$timeout","$route","$interval","ngDialog","w","caching","changeview",function($scope,$http,$location,$rootScope,$timeout,$route,$interval,ngDialog,w,caching,changeview){var iam=this;if(typeof iam.imgStretched==="undefined"){iam.w=w;if($route.current.loadedTemplateUrl==="views/login.html")iam.imgStretched=$.backstretch("img/1.jpg");else $(".backstretch").remove();iam.signIn=function(){w.viewLogin.phU.v=$("#phU").val();
w.viewLogin.phP.v=$("#phP").val();(function(){$(".backstretch").remove();changeview($location,"/start")})()}}}]);
var oStartCtrl=oM.controller("oStartCtrl",["$scope","$http","$location","$rootScope","$timeout","$route","$interval","ngDialog","w","caching","csvToArray","csvToJson","getJsonFile",function($scope,$http,$location,$rootScope,$timeout,$route,$interval,ngDialog,w,caching,csvToArray,csvToJson,getJsonFile){var iam=this;if(typeof iam.changeView==="undefined"){caching.setCache("sessionStorage","employeesIndicator",false,true);caching.setCache("sessionStorage","issuesIndicator",false,true);var employees;
var issues;(new Promise(function(resolve,reject){resolve(function(){employees=getJsonFile("https://chicagodata.blob.core.windows.net/data/employees.json")}())})).then(function(result){caching.setCache("sessionStorage","employees",JSON.stringify(employees),true);caching.setCache("sessionStorage","employeesIndicator",true,true);(new Promise(function(resolve,reject){resolve(function(){issues=csvToJson("https://chicagodata.blob.core.windows.net/data/Issues0.csv")}())})).then(function(result){caching.setCache("sessionStorage",
"issues",JSON.stringify(issues),true);caching.setCache("sessionStorage","issuesIndicator",true,true);(new Promise(function(resolve,reject){resolve(function(){}())})).then(function(result){iam.changeView=function(view){$location.url(view)};iam.getMaps=function(){iam.changeView("/maps")};iam.getCharts=function(){iam.changeView("/charts")};iam.getDetails=function(){iam.changeView("/details")};iam.redirect=function(v){switch(v){case "errorLogs":iam.changeView("/errorLogs");break;case "eventLogs":iam.changeView("/errorLogs");
break;default:break}}},function(err){})},function(err){})},function(err){})}}]);
var oMapsCtrl=oM.controller("oMapsCtrl",["$scope","$http","$location","$rootScope","$timeout","$route","$interval","ngDialog","NgMap","w","caching","toUSD","getJsonFile",function($scope,$http,$location,$rootScope,$timeout,$route,$interval,ngDialog,NgMap,w,caching,toUSD,getJsonFile){var iam=this;if(typeof iam.changeView==="undefined"){iam.changeView=function(view){$location.url(view)};iam.getMenu=function(){iam.changeView("/start")};iam.startlocation=new google.maps.LatLng(40.7125031,-74.0100727999999);
iam.w=$("#map").width();iam.convertToCurrency=function(n){return toUSD(n)};iam.offices=[];iam.office={};(new Promise(function(resolve,reject){resolve(function(){iam.offices=caching.getCache("sessionStorage","employees");iam.office=iam.offices[0];iam.showDetail=function(e,office){iam.office=office;iam.map.showInfoWindow("foo-iw",office.id)};iam.hideDetail=function(){iam.map.hideInfoWindow("foo-iw")};var c=1;$interval(function(){if($location.url()==="/maps"){var tD=[];var tAdd={};(new Promise(function(resolve,
reject){resolve(function(){tAdd=getJsonFile("https://chicagodata.blob.core.windows.net/data/employees"+c+".json")}())})).then(function(result){tD=caching.getCache("sessionStorage","employees")},function(err){}).then(function(result){tD.push(tAdd);caching.setCache("sessionStorage","employees",JSON.stringify(tD),true);iam.offices=tD},function(err){});c+=1}},5E3,5)}())})).then(function(result){NgMap.getMap().then(function(map){iam.map=map})},function(err){})}}]);
var oChartsCtrl=oM.controller("oChartsCtrl",["$scope","$http","$location","$rootScope","$timeout","$route","$interval","$filter","ngDialog","w","caching","getOpenClosedIssues","dataGrouping","csvToJson",function($scope,$http,$location,$rootScope,$timeout,$route,$interval,$filter,ngDialog,w,caching,getOpenClosedIssues,dataGrouping,csvToJson){var iam=this;if(typeof iam.changeView==="undefined"){iam.changeView=function(view){$location.url(view)};iam.getMenu=function(){iam.changeView("/start")};iam.url=
"company02/company02/views/chartsoi.html";if(window.innerHeight>=500)iam.h=100;else iam.h=window.innerHeight*.75;iam.getView=function(e){iam.url="views/"+e.target.id+".html"};iam.issues=caching.getCache("sessionStorage","issues");(new Promise(function(resolve,reject){resolve(function(){iam.OCI=getOpenClosedIssues(iam.issues)}())})).then(function(result){iam.oiLabels=["Open Issues","Closed Issues"];iam.oiData=[iam.OCI.open,iam.OCI.closed];(new Promise(function(resolve,reject){resolve(function(){iam.PC=dataGrouping(iam.issues,
$filter)}())})).then(function(result){iam.pcLabels=iam.PC.arrMonthCTData.arrLabels;iam.pcSeries=["Paid customers","Total $ received"];iam.pcData=[iam.PC.arrMonthCTData.arr0,iam.PC.arrMonthCTData.arr1];iam.pcOnClick=function(points,evt){};iam.pcDatasetOverride=[{yAxisID:"y-axis-1"},{yAxisID:"y-axis-2"}];iam.pcOptions={scales:{yAxes:[{id:"y-axis-1",type:"linear",display:true,position:"left"},{id:"y-axis-2",type:"linear",display:true,position:"right"}]}};iam.riLabels=iam.PC.arrMonthSTData.arrLabels;
iam.riSeries=["Open issues","Resolved post fact um issues"];iam.riData=[iam.PC.arrMonthSTData.arr0,iam.PC.arrMonthSTData.arr1]},function(err){})},function(err){});iam.OCI;iam.PC;var c=0;var p=0;$interval(function(){if($location.url()==="/charts"){var issues;if(c===6){c=0;p=1}if(p===0&&c===0);else(new Promise(function(resolve,reject){resolve(function(){issues=csvToJson("https://chicagodata.blob.core.windows.net/data/Issues"+c+".csv")}())})).then(function(result){iam.issues=issues;(new Promise(function(resolve,
reject){resolve(function(){iam.OCI=getOpenClosedIssues(iam.issues)}())})).then(function(result){iam.oiLabels=["Open Issues","Closed Issues"];iam.oiData=[iam.OCI.open,iam.OCI.closed];(new Promise(function(resolve,reject){resolve(function(){iam.PC=dataGrouping(iam.issues,$filter)}())})).then(function(result){iam.pcLabels=iam.PC.arrMonthCTData.arrLabels;iam.pcSeries=["Paid customers","Total $ received"];iam.pcData=[iam.PC.arrMonthCTData.arr0,iam.PC.arrMonthCTData.arr1];iam.pcOnClick=function(points,
evt){};iam.pcDatasetOverride=[{yAxisID:"y-axis-1"},{yAxisID:"y-axis-2"}];iam.pcOptions={scales:{yAxes:[{id:"y-axis-1",type:"linear",display:true,position:"left"},{id:"y-axis-2",type:"linear",display:true,position:"right"}]}};iam.riLabels=iam.PC.arrMonthSTData.arrLabels;iam.riSeries=["Open issues","Resolved post fact um issues"];iam.riData=[iam.PC.arrMonthSTData.arr0,iam.PC.arrMonthSTData.arr1]},function(err){})},function(err){})},function(err){console.log(err)});c+=1}},5E3)}}]);
var oDetailsCtrl=oM.controller("oDetailsCtrl",["$scope","$http","$location","$rootScope","$timeout","$route","$interval","ngDialog","uiGridConstants","w","caching","csvToArray","csvToJson",function($scope,$http,$location,$rootScope,$timeout,$route,$interval,ngDialog,uiGridConstants,w,caching,csvToArray,csvToJson){var iam=this;if(typeof iam.changeView==="undefined"){iam.changeView=function(view){$location.url(view)};iam.getMenu=function(){iam.changeView("/start")};iam.gridOptions={enableFiltering:true,
flatEntityAccess:true,showGridFooter:true,fastWatch:false};iam.gridOptions.columnDefs=[{field:"submission timestamp",displayName:"Submitted",width:200,pinnedRight:true},{name:"customer name",displayName:"Customer",width:200,pinnedRight:true},{name:"customer email address",displayName:"Email",width:200,pinnedRight:true},{name:"description",displayName:"Description",width:200,pinnedRight:true},{name:"open/closed status",displayName:"Status",width:200,pinnedRight:true},{name:"closed timestamp",displayName:"Closed",
width:200,pinnedRight:true}];iam.gridOptions.data=[];iam.gridOptions.data=csvToJson("https://chicagodata.blob.core.windows.net/data/Issues0.csv");iam.hideTable=false;iam.showData=function(){iam.hideTable=!iam.hideTable}}}]);
